# **1 基于深度学习的两阶段目标检测方法**

两阶段目标检测方法，就是将目标检测过程分为两个阶段：
1. 首先在目标图像上生成多个区域预选框
2. 然后对预选框内的目标区域进行分类以及回归，从而得到最终的检测结果。

这一类目标检测方法包括经典区域卷积网络RCNN系列（RCNN，Fast RCNN、Faster RCNN）以及相关变体，例如基于特征金字塔网络（Feature Pramid Network）、Mask RCNN、带有高阶统计信息（Multi-scale Loaction-aware Kernerl Representation，MLKP）的Faster RCNN。

目标检测不但要识别出目标类别，还要准确描绘出目标边界。

## **1.1 R-CNN**
### **1.1.1 算法引言**
RCNN不需要手工设计特征，它通过在图像生成若干个候选区域，并对每个候选区域利用深层卷积神经网络学习其特征表达。然后训练支持向量机SVM对候选区域进行分类和筛选，得分最高的候选区域即为最终的检测目标。

- RCNN用小样本对深层卷积网络进行参数微调，进一步提升检测算法的性能。
- 利用【非极大值抑制】和【坐标回归】等策略提高算法准确度
  
### **1.1.2 基础原理**

RCNN总共分为三个模块：

![](img/RCNN.png)

- 区域预选框生成
    
    Selective Searsh在图中生成2000个左右区域预选框，而这些预选框基本上涵盖了图像中所有物体。

    接下来判断这些区域预选框是前景还是背景。

    选择性搜索之前，区域预选框是基于滑窗的。使用不同尺寸的矩形框一行一行地扫描整张图像，通过提取矩形框内的特征，判断是否有待检测的物体。时间复杂度高，效率慢。Selective Search的改进：
    - 传统方法需要使用不同尺寸的矩形框检测物体，防止遗漏。选择性搜索方法采用了一种具备层次结构的方法解决这个问题。
    - 选择性搜索的方法将产生预选框和检测两个过程解耦，首先快速的产生可能是 物体的区域，然后在进行具体的检测。
    - 选择性搜索的方法使用多种先验知识来对各个区域进行简单的判别，避免一些无用的搜索，提高速度和精度

    选择性搜索的主要步骤：
    - 使用图分割方法将图像初始化为很多区域集合$R$。初始化一个相似度集合$S$，且$S$为空集【初始区域】
    - 计算集合$R$中所有相邻区域的相似度，并将结果放入到集合 $S$中，集合$S$保存的是一个区域对以及他们之间的相似度【计算相似度】
    - 找出集合$S$中相似度最高的区域对，并将对应区域合并。从$S$中删除与它们相关的所有相似度和区域对。步骤重复这两步，直到$S$为空。【合并最相似区域、删除其他相似区域】
    - 从$R$中找出所有包围区域的最小矩形框，这些矩形框就是物体可能的区域。为了提高速度，新合并区域的特征可以通过之前两个区域获得，而不必重新遍历新区域的像素点进行计算。【得到结果】

    计算两个区域的相似度是选择性搜索方法的关键步骤，作者提出了一种互补相似度测量的方法，使用**颜色，纹理，尺寸和交叠四个指标来度量两个独立区域的相似程度**。 最后，提取由选择性搜索方法得到的区域的**SIFT特征（尺度不变特征变换（Scale-invariant feature transform，SIFT））**，使用 SVM 分类器对区域进行 分类，得到最终的检测结果

- 特征表达学习
    - 通过直接将区域预选框内的内容拉伸为固定尺寸（227 × 227）输入网络
    - 下面是RCNN使用的特征表达学习框架：
        ![](img/RCNN框架.png)
- 区域预选框分类及回归
  - 一对多的多分类SVM分类器
  - 难样本挖掘的策略
  - 训练好的SVM分类器可以对每个区域预选框进行判别分类（前景、后景）
  - 回归的方法：将预选框和真实边界框坐标进行回归
  - 给定一组输入特征向量，通过学习一组参数，使得经过线性回归后的结果尽量接近真值
    ![](img/RCNN_回归.png)

    表示从深层卷积神经网络最后一个池化层得到的特征表达。最终的回归目标为：

    ![](img/RCNN_最终.png)

上面分别介绍了 R-CNN 的三个重要组成部分，其整体流程图如图:
![](img/RCNN_流程.png)

- RCNN的训练：
- 基于监督信息的模型预训练
    
    ImageNet 数据 集只包括图像的类别标签 (即监督信息)，而没有真实边界框坐标信息，所以这部分训练只针对于分类任务，而不包括回归任务
- 特定任务上的参数微调
    
    在第二阶段 训练过程中使用较小学习率 (例如 0.001)的随机梯度下降 (Stochastic Gridient Decend, SGD)在特定数据集上继续调整网络参数。
- 训练特定类别的分类器

    每类训练一个线性 SVM 分类器用于判断预选框内的内容。